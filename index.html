 <!DOCTYPE html>
 <html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Розклад групи ТК-22-01</title>
    <link rel="icon" type="image/png" href="1.png">
    
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta property="og:title" content="Розклад групи ТК-22-01">
    <meta property = "og:image" content="1.png">
    <meta property="og:type" content="website">
</head>
<style>
    /*<meta name="viewport" content="width=device-width, initial-scale=3">*/

    body { font-family: Arial, sans-serif; margin: 20px; }
    table {
        border-collapse: collapse;
        width: 100%;
        margin-bottom: 20px;
        table-layout: fixed;
        }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; font-size: 18px;}
    th { background-color: #f0f0f0; }
    caption { font-size: 25px; margin-bottom: 10px; }

    th:nth-child(1), td:nth-child(1) { width: 5%; }   /* № */
    th:nth-child(2), td:nth-child(2) { width: 20%; }  /* Час */
    th:nth-child(3), td:nth-child(3) { width: 35%; }  /* Предмет */
    th:nth-child(4), td:nth-child(4) { width: 10%; }  /* Аудиторія */
    th:nth-child(5), td:nth-child(5) { width: 15%; }  /* Викладач */

    #date_dropdown{
        width: 230px;
        height: 50px;
        font-size: 20px;
        margin-bottom: 20px;
    }
    .noscale {
        -webkit-text-size-adjust: none;
        text-size-adjust: none;
    }
    .highilight{
        font-weight: bold;
        font-style: italic;
        /*background-color: #f5f5f5;*/
    }
    .underline_b_i{
        font-weight: bold;
        font-style: italic;
        text-decoration: underline;
        /*background-color: #f5f5f5;*/
    }
  </style>
<body>

<p style="font-size:200%;text-align:center;"><i>Розклад занять групи ТК-22-01</i></p>
<p style="font-size:150%;text-align:center;" id="week-date"></p>


<div style="text-align:center">
    <select style="text-align:center;" name="День" id="date_dropdown">
        <option value="today">Сьогодні</option>
        <option value="this_week">Поточний тиждень</option>
        <option value="next_week">Наступний тиждень</option>
        <option value="week_1_3">Весь тиждень (1,3)</option>
        <option value="week_2_4">Весь тиждень (2,4)</option>
        <option value="week_all">Весь розклад (1,2,3,4)</option>
    </select>
</div>

<div class="noscale" id="table"></div>

<p id="weekend_text1" style="font-size:250%;text-align:center;"></p>
<p id="weekend_text2" style="text-align:center;"></p>

<p class="noscale">Остання синхронізаці розкладу відбулася в:</p>
<p class="noscale" id="last_sync_time"></p>

<hr>

<p class="noscale" style="font-size:14px;text-align:right;">
    <i>Створив Фігол В.Т. ексклюзивно для групи ТК-22-01.</i>
</p>

<script>
    const BASE_MONDAY = new Date(2025, 8, 1) // дата ПОНЕДІЛКА першого тижня (рік, місяці[0-11], день)
                                             // 1 вересня
    const OFFSET = 5; //за скільки хв до початку пари ряд таблиці виділиться
                      //та скільки хв пара буде виділена після кінця

    //const today_date = new Date(2025, 8, 24, 21, 0);
    const today_date = new Date();

    DAY_NAMES_UA = {mon:'Понеділок', tue:'Вівторок', wed:'Середа', thu:'Четвер', fri:'Пʼятниця'};
    const table_cont = document.getElementById("table");

    const date_UA = format_date_UA(today_date);
    const week_UA = get_curr_week(today_date) === "even" ? "Тиждень 2,4 (знаменник)": "Тиждень 1,3 (чисельник)"
    document.getElementById("week-date").innerHTML = `<i>Сьогодні ${date_UA}. ${week_UA}</i>`;


    const dropdown = document.getElementById("date_dropdown");
    if (is_time_in_range("00:00-20:30", today_date)){
        dropdown.value = "today";
        loadSchedule("today");
    } else {
        dropdown.value = "this_week";
        loadSchedule("this_week");
    }
    dropdown.addEventListener("change", function() {
        const selected = dropdown.value;
        table_cont.innerHTML = ''; //очищує таблицю
        loadSchedule(selected);
    })

    async function loadSchedule(date_select){
        const response = await fetch("schedule.json");
        const schedule = await response.json();
        const metadata = schedule["metadata"];
        const last_sync_date = new Date(metadata.Time * 1000);
        const last_sync_date_str = last_sync_date.toLocaleString('uk-UA', {
                                                                            weekday: 'long',
                                                                            day: '2-digit',
                                                                            month: '2-digit',
                                                                            year: 'numeric',
                                                                            hour: '2-digit',
                                                                            minute: '2-digit',
                                                                            second: '2-digit'
                                                                            });
                                                                        
        const time_from_last_sync = (today_date - last_sync_date)/60000;

        document.getElementById("last_sync_time").innerHTML = `${last_sync_date_str} (~${Math.floor(time_from_last_sync)} хвилин тому).`;
        const days = Object.keys(schedule).filter(key => key !== "metadata")
        const curr_day = format_date_3let_weekday(today_date);

        if (date_select === "today") render_table(schedule, curr_day, date_select, today_date);
        else {
            days.forEach(day => {
                render_table(schedule, day, date_select, today_date);
            });
        }
    }


    function render_table(schedule, day, date_select, today_date){
        const weekend_text1 = document.getElementById("weekend_text1");
        const weekend_text2 = document.getElementById("weekend_text2");
        if (!schedule[day]) {
            weekend_text1.innerHTML = "<i><b>Ти що? Які пари? Сьогодні вихідний!</b></i>";
            weekend_text2.innerHTML = "<i>(Або ситуація вийшла з під контролю та розклад зламався...)</i>";
            return;
        }
        weekend_text1.innerHTML = ""
        weekend_text2.innerHTML = ""
        
        lessons = schedule[day];

        const table = document.createElement("table");
        const caption = document.createElement("caption");
        caption.textContent = DAY_NAMES_UA[day];

        const thead = document.createElement("thead");
        thead.innerHTML = '<tr><th>№</th><th>Час</th><th>Предмет</th><th>Аудиторія</th><th>Викладач</th></tr>';
        table.appendChild(thead);
        const tbody = document.createElement("tbody");

        week2 = "";
        if (date_select === "today" || date_select === "this_week") week = get_curr_week(today_date);
        else if (date_select === "next_week") week = get_curr_week(today_date) === "even" ? "odd": "even"; 
        else if (date_select === "week_1_3") week = "odd";
        else if (date_select === "week_2_4") week = "even";
        else if (date_select === "week_all") {
            week = "odd";
            week2 = "even";
        }

        lessons.forEach(lesson => {
            const tr = document.createElement('tr');
            if (day === format_date_3let_weekday(today_date) && is_time_in_range(lesson.time, today_date)) {
                tr.classList.add("highilight"); //підкреслити поточну пару
            }
            if (day === format_date_3let_weekday(today_date)){ //підкреслити сьогоднішній день тижня в розкладі на тиждень
                caption.classList.add("underline_b_i");
            }
            if (date_select !== "today"){ //не показувати день тиижня над таблицею якщо вибрано 'сьогодні'
                table.appendChild(caption);
            }
            if(lesson.weeks === week || lesson.weeks === week2 || lesson.weeks === "all") {
                tr.innerHTML = `<td>${parseInt(lesson.num)}</td>
                                <td>${lesson.time}</td>
                                <td>${lesson.subject}</td>
                                <td>${lesson.room}</td>
                                <td>${lesson.teacher}</td>`;
                tbody.appendChild(tr);
            }
        });
        
        table.appendChild(tbody);
        table_cont.appendChild(table);
    }

    function get_curr_week(date){
        const week_num = Math.floor((date - BASE_MONDAY)/604800000); //кількість тижнів яка прийшла від BASE_MONDAY
        return week_num % 2 === 1 ? "even":"odd";
    }
    function format_date_UA (date){
        return date.toLocaleString('uk-UA', {weekday:'long', day:'2-digit', month:'2-digit', year:'numeric'});
    }
    function format_date_3let_weekday(date) {
        return date.toLocaleString("en-UK", {weekday:"short"}).toLowerCase();
    }
    function is_time_in_range(lesson_time, curr_date) {

        const start = lesson_time.split("-")[0].split(":");
        const end = lesson_time.split("-")[1].split(":");
        
        const year = curr_date.getFullYear();
        const month = curr_date.getMonth();
        const day = curr_date.getDate();

        const start_date = new Date(year, month, day, start[0], start[1] - OFFSET);
        const end_date = new Date(year, month, day, end[0], (parseInt(end[1]) + OFFSET));
        
        return curr_date > start_date && curr_date < end_date;
    }
</script>

</body>
</html>

